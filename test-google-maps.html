<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Test</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
            border-radius: 8px;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Google Maps JavaScript API Test</h1>
    <div id="map"></div>
    
    <script>
        let map;
        let markers = {};
        let infoWindow;

        async function initMap() {
            const { Map, InfoWindow } = await google.maps.importLibrary("maps");
            const { Place } = await google.maps.importLibrary("places");
            const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
            const { LatLngBounds } = await google.maps.importLibrary("core");

            // Center on Plano, TX
            const center = { lat: 33.0198, lng: -96.6989 };
            map = new Map(document.getElementById('map'), {
                center: center,
                zoom: 13,
                mapTypeControl: false,
                mapId: 'DEMO_MAP_ID',
            });

            infoWindow = new InfoWindow();

            // Search for grocery stores
            const request = {
                textQuery: 'grocery stores near 6401 Independence Pkwy, Plano, TX',
                fields: ['displayName', 'location', 'businessStatus', 'formattedAddress'],
                includedType: 'grocery_store',
                useStrictTypeFiltering: true,
                isOpenNow: true,
                language: 'en-US',
                maxResultCount: 8,
                minRating: 1,
                region: 'us',
            };

            try {
                const { places } = await Place.searchByText(request);

                if (places.length) {
                    const bounds = new LatLngBounds();

                    // Create markers for each place
                    places.forEach((place, index) => {
                        const marker = new AdvancedMarkerElement({
                            map,
                            position: place.location,
                            title: place.displayName,
                        });

                        markers[place.id] = marker;

                        // Add click listener
                        marker.addListener('gmp-click', () => {
                            map.panTo(place.location);
                            updateInfoWindow(place.displayName, place.formattedAddress || place.displayName, marker);
                        });

                        if (place.location != null) {
                            bounds.extend(place.location);
                        }
                    });

                    map.fitBounds(bounds);
                    console.log('Found', places.length, 'grocery stores');
                } else {
                    console.log('No grocery stores found');
                }
            } catch (error) {
                console.error('Error searching for places:', error);
            }
        }

        // Helper function to create an info window
        function updateInfoWindow(title, content, anchor) {
            infoWindow.setContent(content);
            infoWindow.setHeaderContent(title);
            infoWindow.open({
                map,
                anchor,
                shouldFocus: false,
            });
        }

        // Load Google Maps API
        function loadGoogleMaps() {
            const script = document.createElement('script');
            script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyD8dkXiyOx4XoVIF4hosNG91h47zgPnsQY&libraries=places&callback=initMap';
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }

        // Initialize when page loads
        window.onload = loadGoogleMaps;
    </script>
</body>
</html>
